require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"LayerSVG":[function(require,module,exports){
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

exports.LayerSVG = (function(superClass) {
  extend(LayerSVG, superClass);

  function LayerSVG(options) {
    if (options == null) {
      options = {};
    }
    LayerSVG.__super__.constructor.call(this, options);
    this.shapes = {};
    this.masks = {};
    this.html = "<svg id='" + options.id + "' width='" + this.width + "' height='" + this.height + "'><defs></defs></svg>";
    this.svg = this.querySelector("#" + options.id);
  }

  LayerSVG.prototype.addShape = function(options) {
    var option, shape, value;
    if (options == null) {
      options = {};
    }
    if (options.shape === "rectangle") {
      options.shape = "rect";
    }
    shape = document.createElementNS("http://www.w3.org/2000/svg", "" + options.shape);
    for (option in options) {
      if (!hasProp.call(options, option)) continue;
      value = options[option];
      if (option !== "shape") {
        shape.setAttributeNS(null, "" + option, "" + options[option]);
      }
    }
    this.svg.appendChild(shape);
    this.shapes["" + options.id] = shape;
    return shape;
  };

  LayerSVG.prototype.addMask = function(id, shapes) {
    var defs, i, len, mask, shape;
    mask = document.createElementNS("http://www.w3.org/2000/svg", "mask");
    mask.setAttributeNS(null, "id", "" + id);
    if (shapes !== void 0) {
      for (i = 0, len = shapes.length; i < len; i++) {
        shape = shapes[i];
        if (shapes) {
          mask.appendChild(shape);
        }
      }
    }
    defs = this.svg.getElementsByTagName("defs")[0];
    return defs.appendChild(mask);
  };

  LayerSVG.prototype.addToMask = function(id, element, prevElement) {
    var mask;
    if (typeof id !== "string") {
      id = id.getAttributeNS(null, "id");
      mask = this.svg.getElementById("" + id);
    } else {
      id = this.svg.getElementById("" + id);
      mask = id;
    }
    if (!prevElement) {
      return mask.appendChild(element);
    } else {
      return mask.insertBefore(element, prevElement);
    }
  };

  LayerSVG.prototype.mask = function(element, id) {
    if (typeof id !== "string") {
      id = id.getAttributeNS(null, "id");
    }
    return element.setAttributeNS(null, "mask", "url(#" + id + ")");
  };

  return LayerSVG;

})(Layer);



},{}],"LayerSVG":[function(require,module,exports){
// Generated by CoffeeScript 1.9.1
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

exports.LayerSVG = (function(superClass) {
  extend(LayerSVG, superClass);

  function LayerSVG(options) {
    if (options == null) {
      options = {};
    }
    LayerSVG.__super__.constructor.call(this, options);
    this.shapes = {};
    this.masks = {};
    this.html = "<svg id='" + options.id + "' width='" + this.width + "' height='" + this.height + "'><defs></defs></svg>";
    this.svg = this.querySelector("#" + options.id);
  }

  LayerSVG.prototype.addShape = function(options) {
    var option, shape, value;
    if (options == null) {
      options = {};
    }
    if (options.shape === "rectangle") {
      options.shape = "rect";
    }
    shape = document.createElementNS("http://www.w3.org/2000/svg", "" + options.shape);
    for (option in options) {
      if (!hasProp.call(options, option)) continue;
      value = options[option];
      if (option !== "shape") {
        shape.setAttributeNS(null, "" + option, "" + options[option]);
      }
    }
    this.svg.appendChild(shape);
    this.shapes["" + options.id] = shape;
    return shape;
  };

  LayerSVG.prototype.addMask = function(id, shapes) {
    var defs, i, len, mask, shape;
    mask = document.createElementNS("http://www.w3.org/2000/svg", "mask");
    mask.setAttributeNS(null, "id", "" + id);
    if (shapes !== void 0) {
      for (i = 0, len = shapes.length; i < len; i++) {
        shape = shapes[i];
        if (shapes) {
          mask.appendChild(shape);
        }
      }
    }
    defs = this.svg.getElementsByTagName("defs")[0];
    return defs.appendChild(mask);
  };

  LayerSVG.prototype.addToMask = function(id, element, prevElement) {
    var mask;
    if (typeof id !== "string") {
      id = id.getAttributeNS(null, "id");
      mask = this.svg.getElementById("" + id);
    } else {
      id = this.svg.getElementById("" + id);
      mask = id;
    }
    if (!prevElement) {
      return mask.appendChild(element);
    } else {
      return mask.insertBefore(element, prevElement);
    }
  };

  LayerSVG.prototype.mask = function(element, id) {
    if (typeof id !== "string") {
      id = id.getAttributeNS(null, "id");
    }
    return element.setAttributeNS(null, "mask", "url(#" + id + ")");
  };

  return LayerSVG;

})(Layer);

},{}],"myModule":[function(require,module,exports){
exports.myVar = "myVariable";

exports.myFunction = function() {
  return print("myFunction is running");
};

exports.myArray = [1, 2, 3];



},{}]},{},[])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvam9zaG10dWNrZXIvR2l0SHViL0xheWVyU1ZHL0xheWVyU1ZHLmZyYW1lci9tb2R1bGVzL0xheWVyU1ZHLmNvZmZlZSIsIi4uLy4uLy4uLy4uLy4uL1VzZXJzL2pvc2htdHVja2VyL0dpdEh1Yi9MYXllclNWRy9MYXllclNWRy5mcmFtZXIvbW9kdWxlcy9MYXllclNWRy5qcyIsIi9Vc2Vycy9qb3NobXR1Y2tlci9HaXRIdWIvTGF5ZXJTVkcvTGF5ZXJTVkcuZnJhbWVyL21vZHVsZXMvbXlNb2R1bGUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsSUFBQTs2QkFBQTs7QUFBQSxPQUFhLENBQUM7QUFDYiw4QkFBQSxDQUFBOztBQUFhLEVBQUEsa0JBQUMsT0FBRCxHQUFBOztNQUFDLFVBQVE7S0FFckI7QUFBQSxJQUFBLDBDQUFNLE9BQU4sQ0FBQSxDQUFBO0FBQUEsSUFFQSxJQUFDLENBQUEsTUFBRCxHQUFVLEVBRlYsQ0FBQTtBQUFBLElBR0EsSUFBQyxDQUFBLEtBQUQsR0FBUyxFQUhULENBQUE7QUFBQSxJQUlBLElBQUMsQ0FBQSxJQUFELEdBQVEsV0FBQSxHQUFZLE9BQU8sQ0FBQyxFQUFwQixHQUF1QixXQUF2QixHQUFrQyxJQUFDLENBQUMsS0FBcEMsR0FBMEMsWUFBMUMsR0FBc0QsSUFBQyxDQUFDLE1BQXhELEdBQStELHVCQUp2RSxDQUFBO0FBQUEsSUFLQSxJQUFDLENBQUEsR0FBRCxHQUFPLElBQUMsQ0FBQyxhQUFGLENBQWdCLEdBQUEsR0FBSSxPQUFPLENBQUMsRUFBNUIsQ0FMUCxDQUZZO0VBQUEsQ0FBYjs7QUFBQSxxQkFVQSxRQUFBLEdBQVUsU0FBQyxPQUFELEdBQUE7QUFFVCxRQUFBLG9CQUFBOztNQUZVLFVBQVE7S0FFbEI7QUFBQSxJQUFBLElBQUcsT0FBTyxDQUFDLEtBQVIsS0FBaUIsV0FBcEI7QUFDQyxNQUFBLE9BQU8sQ0FBQyxLQUFSLEdBQWdCLE1BQWhCLENBREQ7S0FBQTtBQUFBLElBR0EsS0FBQSxHQUFRLFFBQVEsQ0FBQyxlQUFULENBQXlCLDRCQUF6QixFQUF1RCxFQUFBLEdBQUcsT0FBTyxDQUFDLEtBQWxFLENBSFIsQ0FBQTtBQUtBLFNBQUEsaUJBQUE7OzhCQUFBO0FBQ0MsTUFBQSxJQUFHLE1BQUEsS0FBWSxPQUFmO0FBQ0MsUUFBQSxLQUFLLENBQUMsY0FBTixDQUFxQixJQUFyQixFQUEyQixFQUFBLEdBQUcsTUFBOUIsRUFBd0MsRUFBQSxHQUFHLE9BQVEsQ0FBQSxNQUFBLENBQW5ELENBQUEsQ0FERDtPQUREO0FBQUEsS0FMQTtBQUFBLElBU0EsSUFBQyxDQUFBLEdBQUcsQ0FBQyxXQUFMLENBQWlCLEtBQWpCLENBVEEsQ0FBQTtBQUFBLElBVUEsSUFBQyxDQUFBLE1BQU8sQ0FBQSxFQUFBLEdBQUcsT0FBTyxDQUFDLEVBQVgsQ0FBUixHQUEyQixLQVYzQixDQUFBO0FBWUEsV0FBTyxLQUFQLENBZFM7RUFBQSxDQVZWLENBQUE7O0FBQUEscUJBMEJBLE9BQUEsR0FBUyxTQUFDLEVBQUQsRUFBSyxNQUFMLEdBQUE7QUFDUixRQUFBLHlCQUFBO0FBQUEsSUFBQSxJQUFBLEdBQU8sUUFBUSxDQUFDLGVBQVQsQ0FBeUIsNEJBQXpCLEVBQXVELE1BQXZELENBQVAsQ0FBQTtBQUFBLElBQ0EsSUFBSSxDQUFDLGNBQUwsQ0FBb0IsSUFBcEIsRUFBMEIsSUFBMUIsRUFBZ0MsRUFBQSxHQUFHLEVBQW5DLENBREEsQ0FBQTtBQUdBLElBQUEsSUFBRyxNQUFBLEtBQVksTUFBZjtBQUNDLFdBQUEsd0NBQUE7MEJBQUE7WUFBeUI7QUFDeEIsVUFBQSxJQUFJLENBQUMsV0FBTCxDQUFpQixLQUFqQixDQUFBO1NBREQ7QUFBQSxPQUREO0tBSEE7QUFBQSxJQU9BLElBQUEsR0FBTyxJQUFDLENBQUMsR0FBRyxDQUFDLG9CQUFOLENBQTJCLE1BQTNCLENBQW1DLENBQUEsQ0FBQSxDQVAxQyxDQUFBO1dBUUEsSUFBSSxDQUFDLFdBQUwsQ0FBaUIsSUFBakIsRUFUUTtFQUFBLENBMUJULENBQUE7O0FBQUEscUJBcUNBLFNBQUEsR0FBVyxTQUFDLEVBQUQsRUFBSyxPQUFMLEVBQWMsV0FBZCxHQUFBO0FBQ1YsUUFBQSxJQUFBO0FBQUEsSUFBQSxJQUFHLE1BQUEsQ0FBQSxFQUFBLEtBQWdCLFFBQW5CO0FBQ0MsTUFBQSxFQUFBLEdBQUssRUFBRSxDQUFDLGNBQUgsQ0FBa0IsSUFBbEIsRUFBd0IsSUFBeEIsQ0FBTCxDQUFBO0FBQUEsTUFDQSxJQUFBLEdBQU8sSUFBQyxDQUFDLEdBQUcsQ0FBQyxjQUFOLENBQXFCLEVBQUEsR0FBRyxFQUF4QixDQURQLENBREQ7S0FBQSxNQUFBO0FBSUMsTUFBQSxFQUFBLEdBQUssSUFBQyxDQUFDLEdBQUcsQ0FBQyxjQUFOLENBQXFCLEVBQUEsR0FBRyxFQUF4QixDQUFMLENBQUE7QUFBQSxNQUNBLElBQUEsR0FBTyxFQURQLENBSkQ7S0FBQTtBQU9BLElBQUEsSUFBRyxDQUFBLFdBQUg7YUFDQyxJQUFJLENBQUMsV0FBTCxDQUFpQixPQUFqQixFQUREO0tBQUEsTUFBQTthQUdDLElBQUksQ0FBQyxZQUFMLENBQWtCLE9BQWxCLEVBQTJCLFdBQTNCLEVBSEQ7S0FSVTtFQUFBLENBckNYLENBQUE7O0FBQUEscUJBa0RBLElBQUEsR0FBTSxTQUFDLE9BQUQsRUFBVSxFQUFWLEdBQUE7QUFDTCxJQUFBLElBQUcsTUFBQSxDQUFBLEVBQUEsS0FBZ0IsUUFBbkI7QUFDQyxNQUFBLEVBQUEsR0FBSyxFQUFFLENBQUMsY0FBSCxDQUFrQixJQUFsQixFQUF3QixJQUF4QixDQUFMLENBREQ7S0FBQTtXQUdBLE9BQU8sQ0FBQyxjQUFSLENBQXVCLElBQXZCLEVBQTZCLE1BQTdCLEVBQXFDLE9BQUEsR0FBUSxFQUFSLEdBQVcsR0FBaEQsRUFKSztFQUFBLENBbEROLENBQUE7O2tCQUFBOztHQUQ4QixNQUEvQixDQUFBOzs7OztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdFQSxPQUFPLENBQUMsS0FBUixHQUFnQixZQUFoQixDQUFBOztBQUFBLE9BRU8sQ0FBQyxVQUFSLEdBQXFCLFNBQUEsR0FBQTtTQUNwQixLQUFBLENBQU0sdUJBQU4sRUFEb0I7QUFBQSxDQUZyQixDQUFBOztBQUFBLE9BS08sQ0FBQyxPQUFSLEdBQWtCLENBQUMsQ0FBRCxFQUFJLENBQUosRUFBTyxDQUFQLENBTGxCLENBQUEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiY2xhc3MgZXhwb3J0cy5MYXllclNWRyBleHRlbmRzIExheWVyIFxuXHRjb25zdHJ1Y3RvcjogKG9wdGlvbnM9e30pIC0+XG5cdFx0XG5cdFx0c3VwZXIgb3B0aW9uc1xuXG5cdFx0QHNoYXBlcyA9IHt9XG5cdFx0QG1hc2tzID0ge31cblx0XHRAaHRtbCA9IFwiPHN2ZyBpZD0nI3tvcHRpb25zLmlkfScgd2lkdGg9JyN7QC53aWR0aH0nIGhlaWdodD0nI3tALmhlaWdodH0nPjxkZWZzPjwvZGVmcz48L3N2Zz5cIlxuXHRcdEBzdmcgPSBALnF1ZXJ5U2VsZWN0b3IoXCIjI3tvcHRpb25zLmlkfVwiKVx0XG5cblxuXHRhZGRTaGFwZTogKG9wdGlvbnM9e30pIC0+XG5cblx0XHRpZiBvcHRpb25zLnNoYXBlIGlzIFwicmVjdGFuZ2xlXCJcblx0XHRcdG9wdGlvbnMuc2hhcGUgPSBcInJlY3RcIlxuXG5cdFx0c2hhcGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBcIiN7b3B0aW9ucy5zaGFwZX1cIikgXG5cblx0XHRmb3Igb3duIG9wdGlvbiwgdmFsdWUgb2Ygb3B0aW9uc1xuXHRcdFx0aWYgb3B0aW9uIGlzbnQgXCJzaGFwZVwiXG5cdFx0XHRcdHNoYXBlLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiI3tvcHRpb259XCIsIFwiI3tvcHRpb25zW29wdGlvbl19XCIpXG5cblx0XHRAc3ZnLmFwcGVuZENoaWxkKHNoYXBlKVxuXHRcdEBzaGFwZXNbXCIje29wdGlvbnMuaWR9XCJdID0gc2hhcGVcblxuXHRcdHJldHVybiBzaGFwZVxuXG5cdGFkZE1hc2s6IChpZCwgc2hhcGVzKSAtPlxuXHRcdG1hc2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBcIm1hc2tcIilcblx0XHRtYXNrLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiaWRcIiwgXCIje2lkfVwiKVxuXG5cdFx0aWYgc2hhcGVzIGlzbnQgdW5kZWZpbmVkXG5cdFx0XHRmb3Igc2hhcGUgaW4gc2hhcGVzIHdoZW4gc2hhcGVzXG5cdFx0XHRcdG1hc2suYXBwZW5kQ2hpbGQoc2hhcGUpXG5cblx0XHRkZWZzID0gQC5zdmcuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJkZWZzXCIpWzBdXG5cdFx0ZGVmcy5hcHBlbmRDaGlsZChtYXNrKVxuXG5cdGFkZFRvTWFzazogKGlkLCBlbGVtZW50LCBwcmV2RWxlbWVudCkgLT5cblx0XHRpZiB0eXBlb2YoaWQpIGlzbnQgXCJzdHJpbmdcIlxuXHRcdFx0aWQgPSBpZC5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcImlkXCIpXG5cdFx0XHRtYXNrID0gQC5zdmcuZ2V0RWxlbWVudEJ5SWQoXCIje2lkfVwiKVxuXHRcdGVsc2UgXG5cdFx0XHRpZCA9IEAuc3ZnLmdldEVsZW1lbnRCeUlkKFwiI3tpZH1cIilcblx0XHRcdG1hc2sgPSBpZFxuXG5cdFx0aWYgIXByZXZFbGVtZW50XG5cdFx0XHRtYXNrLmFwcGVuZENoaWxkKGVsZW1lbnQpXG5cdFx0ZWxzZVxuXHRcdFx0bWFzay5pbnNlcnRCZWZvcmUoZWxlbWVudCwgcHJldkVsZW1lbnQpXG5cblx0bWFzazogKGVsZW1lbnQsIGlkKSAtPlxuXHRcdGlmIHR5cGVvZihpZCkgaXNudCBcInN0cmluZ1wiXG5cdFx0XHRpZCA9IGlkLmdldEF0dHJpYnV0ZU5TKG51bGwsIFwiaWRcIilcblxuXHRcdGVsZW1lbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJtYXNrXCIsIFwidXJsKCMje2lkfSlcIilcblx0XHQiLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuOS4xXG52YXIgZXh0ZW5kID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChoYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9LFxuICBoYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHk7XG5cbmV4cG9ydHMuTGF5ZXJTVkcgPSAoZnVuY3Rpb24oc3VwZXJDbGFzcykge1xuICBleHRlbmQoTGF5ZXJTVkcsIHN1cGVyQ2xhc3MpO1xuXG4gIGZ1bmN0aW9uIExheWVyU1ZHKG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuICAgIExheWVyU1ZHLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuICAgIHRoaXMuc2hhcGVzID0ge307XG4gICAgdGhpcy5tYXNrcyA9IHt9O1xuICAgIHRoaXMuaHRtbCA9IFwiPHN2ZyBpZD0nXCIgKyBvcHRpb25zLmlkICsgXCInIHdpZHRoPSdcIiArIHRoaXMud2lkdGggKyBcIicgaGVpZ2h0PSdcIiArIHRoaXMuaGVpZ2h0ICsgXCInPjxkZWZzPjwvZGVmcz48L3N2Zz5cIjtcbiAgICB0aGlzLnN2ZyA9IHRoaXMucXVlcnlTZWxlY3RvcihcIiNcIiArIG9wdGlvbnMuaWQpO1xuICB9XG5cbiAgTGF5ZXJTVkcucHJvdG90eXBlLmFkZFNoYXBlID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHZhciBvcHRpb24sIHNoYXBlLCB2YWx1ZTtcbiAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnNoYXBlID09PSBcInJlY3RhbmdsZVwiKSB7XG4gICAgICBvcHRpb25zLnNoYXBlID0gXCJyZWN0XCI7XG4gICAgfVxuICAgIHNoYXBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJcIiArIG9wdGlvbnMuc2hhcGUpO1xuICAgIGZvciAob3B0aW9uIGluIG9wdGlvbnMpIHtcbiAgICAgIGlmICghaGFzUHJvcC5jYWxsKG9wdGlvbnMsIG9wdGlvbikpIGNvbnRpbnVlO1xuICAgICAgdmFsdWUgPSBvcHRpb25zW29wdGlvbl07XG4gICAgICBpZiAob3B0aW9uICE9PSBcInNoYXBlXCIpIHtcbiAgICAgICAgc2hhcGUuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJcIiArIG9wdGlvbiwgXCJcIiArIG9wdGlvbnNbb3B0aW9uXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuc3ZnLmFwcGVuZENoaWxkKHNoYXBlKTtcbiAgICB0aGlzLnNoYXBlc1tcIlwiICsgb3B0aW9ucy5pZF0gPSBzaGFwZTtcbiAgICByZXR1cm4gc2hhcGU7XG4gIH07XG5cbiAgTGF5ZXJTVkcucHJvdG90eXBlLmFkZE1hc2sgPSBmdW5jdGlvbihpZCwgc2hhcGVzKSB7XG4gICAgdmFyIGRlZnMsIGksIGxlbiwgbWFzaywgc2hhcGU7XG4gICAgbWFzayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwibWFza1wiKTtcbiAgICBtYXNrLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiaWRcIiwgXCJcIiArIGlkKTtcbiAgICBpZiAoc2hhcGVzICE9PSB2b2lkIDApIHtcbiAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHNoYXBlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBzaGFwZSA9IHNoYXBlc1tpXTtcbiAgICAgICAgaWYgKHNoYXBlcykge1xuICAgICAgICAgIG1hc2suYXBwZW5kQ2hpbGQoc2hhcGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGRlZnMgPSB0aGlzLnN2Zy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImRlZnNcIilbMF07XG4gICAgcmV0dXJuIGRlZnMuYXBwZW5kQ2hpbGQobWFzayk7XG4gIH07XG5cbiAgTGF5ZXJTVkcucHJvdG90eXBlLmFkZFRvTWFzayA9IGZ1bmN0aW9uKGlkLCBlbGVtZW50LCBwcmV2RWxlbWVudCkge1xuICAgIHZhciBtYXNrO1xuICAgIGlmICh0eXBlb2YgaWQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGlkID0gaWQuZ2V0QXR0cmlidXRlTlMobnVsbCwgXCJpZFwiKTtcbiAgICAgIG1hc2sgPSB0aGlzLnN2Zy5nZXRFbGVtZW50QnlJZChcIlwiICsgaWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZCA9IHRoaXMuc3ZnLmdldEVsZW1lbnRCeUlkKFwiXCIgKyBpZCk7XG4gICAgICBtYXNrID0gaWQ7XG4gICAgfVxuICAgIGlmICghcHJldkVsZW1lbnQpIHtcbiAgICAgIHJldHVybiBtYXNrLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbWFzay5pbnNlcnRCZWZvcmUoZWxlbWVudCwgcHJldkVsZW1lbnQpO1xuICAgIH1cbiAgfTtcblxuICBMYXllclNWRy5wcm90b3R5cGUubWFzayA9IGZ1bmN0aW9uKGVsZW1lbnQsIGlkKSB7XG4gICAgaWYgKHR5cGVvZiBpZCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgaWQgPSBpZC5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcImlkXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcIm1hc2tcIiwgXCJ1cmwoI1wiICsgaWQgKyBcIilcIik7XG4gIH07XG5cbiAgcmV0dXJuIExheWVyU1ZHO1xuXG59KShMYXllcik7XG4iLCIjIEFkZCB0aGUgZm9sbG93aW5nIGxpbmUgdG8geW91ciBwcm9qZWN0IGluIEZyYW1lciBTdHVkaW8uIFxuIyBteU1vZHVsZSA9IHJlcXVpcmUgXCJteU1vZHVsZVwiXG4jIFJlZmVyZW5jZSB0aGUgY29udGVudHMgYnkgbmFtZSwgbGlrZSBteU1vZHVsZS5teUZ1bmN0aW9uKCkgb3IgbXlNb2R1bGUubXlWYXJcblxuZXhwb3J0cy5teVZhciA9IFwibXlWYXJpYWJsZVwiXG5cbmV4cG9ydHMubXlGdW5jdGlvbiA9IC0+XG5cdHByaW50IFwibXlGdW5jdGlvbiBpcyBydW5uaW5nXCJcblxuZXhwb3J0cy5teUFycmF5ID0gWzEsIDIsIDNdIl19
