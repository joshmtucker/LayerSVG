require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"LayerSVG":[function(require,module,exports){
// Generated by CoffeeScript 1.9.1
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

exports.LayerSVG = (function(superClass) {
  extend(LayerSVG, superClass);

  function LayerSVG(options) {
    if (options == null) {
      options = {};
    }
    LayerSVG.__super__.constructor.call(this, options);
    this.shapes = {};
    this.masks = {};
    this.html = "<svg id='" + options.id + "' width='" + this.width + "' height='" + this.height + "'><defs></defs></svg>";
    this.svg = this.querySelector("#" + options.id);
  }

  LayerSVG.prototype.addShape = function(options) {
    var option, shape, value;
    if (options == null) {
      options = {};
    }
    if (options.shape === "rectangle") {
      options.shape = "rect";
    }
    shape = document.createElementNS("http://www.w3.org/2000/svg", "" + options.shape);
    for (option in options) {
      if (!hasProp.call(options, option)) continue;
      value = options[option];
      if (option !== "shape") {
        shape.setAttributeNS(null, "" + option, "" + options[option]);
      }
    }
    this.svg.appendChild(shape);
    this.shapes["" + options.id] = shape;
    return shape;
  };

  LayerSVG.prototype.addMask = function(id, shape) {
    var defs, element, i, len, mask;
    mask = document.createElementNS("http://www.w3.org/2000/svg", "mask");
    mask.setAttributeNS(null, "id", "" + id);
    if (!Array.isArray(shape)) {
      if (typeof shape === "string") {
        shape = this.svg.getElementById("" + shape);
        mask.appendChild(shape);
      } else {
        mask.appendChild(shape);
      }
    } else {
      for (i = 0, len = shape.length; i < len; i++) {
        element = shape[i];
        if (typeof element === "string") {
          element = this.svg.getElementById("" + element);
          mask.appendChild(element);
        } else {
          mask.appendChild(element);
        }
      }
    }
    defs = this.svg.getElementsByTagName("defs")[0];
    defs.appendChild(mask);
    return this.masks["" + id] = mask;
  };

  LayerSVG.prototype.addToMask = function(shape, mask, prevElement) {
    if (typeof mask === "string") {
      mask = this.svg.getElementById("" + mask);
    }
    if (!prevElement) {
      return mask.appendChild(shape);
    } else {
      return mask.insertBefore(shape, prevElement);
    }
  };

  LayerSVG.prototype.mask = function(element, id) {
    if (typeof id !== "string") {
      id = id.getAttributeNS(null, "id");
    }
    return element.setAttributeNS(null, "mask", "url(#" + id + ")");
  };

  return LayerSVG;

})(Layer);

},{}],"LayerSVG":[function(require,module,exports){
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

exports.LayerSVG = (function(superClass) {
  extend(LayerSVG, superClass);

  function LayerSVG(options) {
    if (options == null) {
      options = {};
    }
    LayerSVG.__super__.constructor.call(this, options);
    this.shapes = {};
    this.masks = {};
    this.html = "<svg id='" + options.id + "' width='" + this.width + "' height='" + this.height + "'><defs></defs></svg>";
    this.svg = this.querySelector("#" + options.id);
  }

  LayerSVG.prototype.addShape = function(options) {
    var option, shape, value;
    if (options == null) {
      options = {};
    }
    if (options.shape === "rectangle") {
      options.shape = "rect";
    }
    shape = document.createElementNS("http://www.w3.org/2000/svg", "" + options.shape);
    for (option in options) {
      if (!hasProp.call(options, option)) continue;
      value = options[option];
      if (option !== "shape") {
        shape.setAttributeNS(null, "" + option, "" + options[option]);
      }
    }
    this.svg.appendChild(shape);
    this.shapes["" + options.id] = shape;
    return shape;
  };

  LayerSVG.prototype.addMask = function(id, shape) {
    var defs, element, i, len, mask;
    mask = document.createElementNS("http://www.w3.org/2000/svg", "mask");
    mask.setAttributeNS(null, "id", "" + id);
    if (!Array.isArray(shape)) {
      if (typeof shape === "string") {
        shape = this.svg.getElementById("" + shape);
        mask.appendChild(shape);
      } else {
        mask.appendChild(shape);
      }
    } else {
      for (i = 0, len = shape.length; i < len; i++) {
        element = shape[i];
        if (typeof element === "string") {
          element = this.svg.getElementById("" + element);
          mask.appendChild(element);
        } else {
          mask.appendChild(element);
        }
      }
    }
    defs = this.svg.getElementsByTagName("defs")[0];
    defs.appendChild(mask);
    return this.masks["" + id] = mask;
  };

  LayerSVG.prototype.addToMask = function(shape, mask, prevElement) {
    if (typeof mask === "string") {
      mask = this.svg.getElementById("" + mask);
    }
    if (!prevElement) {
      return mask.appendChild(shape);
    } else {
      return mask.insertBefore(shape, prevElement);
    }
  };

  LayerSVG.prototype.mask = function(element, id) {
    if (typeof id !== "string") {
      id = id.getAttributeNS(null, "id");
    }
    return element.setAttributeNS(null, "mask", "url(#" + id + ")");
  };

  return LayerSVG;

})(Layer);



},{}],"myModule":[function(require,module,exports){
exports.myVar = "myVariable";

exports.myFunction = function() {
  return print("myFunction is running");
};

exports.myArray = [1, 2, 3];



},{}]},{},[])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIuLi8uLi8uLi8uLi8uLi9Vc2Vycy9qb3NobXR1Y2tlci9HaXRIdWIvTGF5ZXJTVkcvTGF5ZXJTVkcuZnJhbWVyL21vZHVsZXMvTGF5ZXJTVkcuanMiLCIvVXNlcnMvam9zaG10dWNrZXIvR2l0SHViL0xheWVyU1ZHL0xheWVyU1ZHLmZyYW1lci9tb2R1bGVzL0xheWVyU1ZHLmNvZmZlZSIsIi9Vc2Vycy9qb3NobXR1Y2tlci9HaXRIdWIvTGF5ZXJTVkcvTGF5ZXJTVkcuZnJhbWVyL21vZHVsZXMvbXlNb2R1bGUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkZBLElBQUE7NkJBQUE7O0FBQUEsT0FBYSxDQUFDO0FBQ2IsOEJBQUEsQ0FBQTs7QUFBYSxFQUFBLGtCQUFDLE9BQUQsR0FBQTs7TUFBQyxVQUFRO0tBRXJCO0FBQUEsSUFBQSwwQ0FBTSxPQUFOLENBQUEsQ0FBQTtBQUFBLElBRUEsSUFBQyxDQUFBLE1BQUQsR0FBVSxFQUZWLENBQUE7QUFBQSxJQUdBLElBQUMsQ0FBQSxLQUFELEdBQVMsRUFIVCxDQUFBO0FBQUEsSUFJQSxJQUFDLENBQUEsSUFBRCxHQUFRLFdBQUEsR0FBWSxPQUFPLENBQUMsRUFBcEIsR0FBdUIsV0FBdkIsR0FBa0MsSUFBQyxDQUFDLEtBQXBDLEdBQTBDLFlBQTFDLEdBQXNELElBQUMsQ0FBQyxNQUF4RCxHQUErRCx1QkFKdkUsQ0FBQTtBQUFBLElBS0EsSUFBQyxDQUFBLEdBQUQsR0FBTyxJQUFDLENBQUMsYUFBRixDQUFnQixHQUFBLEdBQUksT0FBTyxDQUFDLEVBQTVCLENBTFAsQ0FGWTtFQUFBLENBQWI7O0FBQUEscUJBVUEsUUFBQSxHQUFVLFNBQUMsT0FBRCxHQUFBO0FBRVQsUUFBQSxvQkFBQTs7TUFGVSxVQUFRO0tBRWxCO0FBQUEsSUFBQSxJQUFHLE9BQU8sQ0FBQyxLQUFSLEtBQWlCLFdBQXBCO0FBQ0MsTUFBQSxPQUFPLENBQUMsS0FBUixHQUFnQixNQUFoQixDQUREO0tBQUE7QUFBQSxJQUdBLEtBQUEsR0FBUSxRQUFRLENBQUMsZUFBVCxDQUF5Qiw0QkFBekIsRUFBdUQsRUFBQSxHQUFHLE9BQU8sQ0FBQyxLQUFsRSxDQUhSLENBQUE7QUFLQSxTQUFBLGlCQUFBOzs4QkFBQTtBQUNDLE1BQUEsSUFBRyxNQUFBLEtBQVksT0FBZjtBQUNDLFFBQUEsS0FBSyxDQUFDLGNBQU4sQ0FBcUIsSUFBckIsRUFBMkIsRUFBQSxHQUFHLE1BQTlCLEVBQXdDLEVBQUEsR0FBRyxPQUFRLENBQUEsTUFBQSxDQUFuRCxDQUFBLENBREQ7T0FERDtBQUFBLEtBTEE7QUFBQSxJQVNBLElBQUMsQ0FBQSxHQUFHLENBQUMsV0FBTCxDQUFpQixLQUFqQixDQVRBLENBQUE7QUFBQSxJQVVBLElBQUMsQ0FBQSxNQUFPLENBQUEsRUFBQSxHQUFHLE9BQU8sQ0FBQyxFQUFYLENBQVIsR0FBMkIsS0FWM0IsQ0FBQTtBQVlBLFdBQU8sS0FBUCxDQWRTO0VBQUEsQ0FWVixDQUFBOztBQUFBLHFCQTBCQSxPQUFBLEdBQVMsU0FBQyxFQUFELEVBQUssS0FBTCxHQUFBO0FBQ1IsUUFBQSwyQkFBQTtBQUFBLElBQUEsSUFBQSxHQUFPLFFBQVEsQ0FBQyxlQUFULENBQXlCLDRCQUF6QixFQUF1RCxNQUF2RCxDQUFQLENBQUE7QUFBQSxJQUNBLElBQUksQ0FBQyxjQUFMLENBQW9CLElBQXBCLEVBQTBCLElBQTFCLEVBQWdDLEVBQUEsR0FBRyxFQUFuQyxDQURBLENBQUE7QUFHQSxJQUFBLElBQUcsQ0FBQSxLQUFNLENBQUMsT0FBTixDQUFjLEtBQWQsQ0FBSjtBQUNDLE1BQUEsSUFBRyxNQUFBLENBQUEsS0FBQSxLQUFpQixRQUFwQjtBQUNDLFFBQUEsS0FBQSxHQUFRLElBQUMsQ0FBQyxHQUFHLENBQUMsY0FBTixDQUFxQixFQUFBLEdBQUcsS0FBeEIsQ0FBUixDQUFBO0FBQUEsUUFDQSxJQUFJLENBQUMsV0FBTCxDQUFpQixLQUFqQixDQURBLENBREQ7T0FBQSxNQUFBO0FBSUMsUUFBQSxJQUFJLENBQUMsV0FBTCxDQUFpQixLQUFqQixDQUFBLENBSkQ7T0FERDtLQUFBLE1BQUE7QUFPQyxXQUFBLHVDQUFBOzJCQUFBO0FBQ0MsUUFBQSxJQUFHLE1BQUEsQ0FBQSxPQUFBLEtBQW1CLFFBQXRCO0FBQ0MsVUFBQSxPQUFBLEdBQVUsSUFBQyxDQUFDLEdBQUcsQ0FBQyxjQUFOLENBQXFCLEVBQUEsR0FBRyxPQUF4QixDQUFWLENBQUE7QUFBQSxVQUNBLElBQUksQ0FBQyxXQUFMLENBQWlCLE9BQWpCLENBREEsQ0FERDtTQUFBLE1BQUE7QUFJQyxVQUFBLElBQUksQ0FBQyxXQUFMLENBQWlCLE9BQWpCLENBQUEsQ0FKRDtTQUREO0FBQUEsT0FQRDtLQUhBO0FBQUEsSUFpQkEsSUFBQSxHQUFPLElBQUMsQ0FBQyxHQUFHLENBQUMsb0JBQU4sQ0FBMkIsTUFBM0IsQ0FBbUMsQ0FBQSxDQUFBLENBakIxQyxDQUFBO0FBQUEsSUFrQkEsSUFBSSxDQUFDLFdBQUwsQ0FBaUIsSUFBakIsQ0FsQkEsQ0FBQTtXQW1CQSxJQUFDLENBQUEsS0FBTSxDQUFBLEVBQUEsR0FBRyxFQUFILENBQVAsR0FBa0IsS0FwQlY7RUFBQSxDQTFCVCxDQUFBOztBQUFBLHFCQWdEQSxTQUFBLEdBQVcsU0FBQyxLQUFELEVBQVEsSUFBUixFQUFjLFdBQWQsR0FBQTtBQUNWLElBQUEsSUFBRyxNQUFBLENBQUEsSUFBQSxLQUFnQixRQUFuQjtBQUNDLE1BQUEsSUFBQSxHQUFPLElBQUMsQ0FBQyxHQUFHLENBQUMsY0FBTixDQUFxQixFQUFBLEdBQUcsSUFBeEIsQ0FBUCxDQUREO0tBQUE7QUFHQSxJQUFBLElBQUcsQ0FBQSxXQUFIO2FBQ0MsSUFBSSxDQUFDLFdBQUwsQ0FBaUIsS0FBakIsRUFERDtLQUFBLE1BQUE7YUFHQyxJQUFJLENBQUMsWUFBTCxDQUFrQixLQUFsQixFQUF5QixXQUF6QixFQUhEO0tBSlU7RUFBQSxDQWhEWCxDQUFBOztBQUFBLHFCQXlEQSxJQUFBLEdBQU0sU0FBQyxPQUFELEVBQVUsRUFBVixHQUFBO0FBQ0wsSUFBQSxJQUFHLE1BQUEsQ0FBQSxFQUFBLEtBQWdCLFFBQW5CO0FBQ0MsTUFBQSxFQUFBLEdBQUssRUFBRSxDQUFDLGNBQUgsQ0FBa0IsSUFBbEIsRUFBd0IsSUFBeEIsQ0FBTCxDQUREO0tBQUE7V0FHQSxPQUFPLENBQUMsY0FBUixDQUF1QixJQUF2QixFQUE2QixNQUE3QixFQUFxQyxPQUFBLEdBQVEsRUFBUixHQUFXLEdBQWhELEVBSks7RUFBQSxDQXpETixDQUFBOztrQkFBQTs7R0FEOEIsTUFBL0IsQ0FBQTs7Ozs7QUNJQSxPQUFPLENBQUMsS0FBUixHQUFnQixZQUFoQixDQUFBOztBQUFBLE9BRU8sQ0FBQyxVQUFSLEdBQXFCLFNBQUEsR0FBQTtTQUNwQixLQUFBLENBQU0sdUJBQU4sRUFEb0I7QUFBQSxDQUZyQixDQUFBOztBQUFBLE9BS08sQ0FBQyxPQUFSLEdBQWtCLENBQUMsQ0FBRCxFQUFJLENBQUosRUFBTyxDQUFQLENBTGxCLENBQUEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjkuMVxudmFyIGV4dGVuZCA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoaGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSxcbiAgaGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5O1xuXG5leHBvcnRzLkxheWVyU1ZHID0gKGZ1bmN0aW9uKHN1cGVyQ2xhc3MpIHtcbiAgZXh0ZW5kKExheWVyU1ZHLCBzdXBlckNsYXNzKTtcblxuICBmdW5jdGlvbiBMYXllclNWRyhvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICBMYXllclNWRy5fX3N1cGVyX18uY29uc3RydWN0b3IuY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICB0aGlzLnNoYXBlcyA9IHt9O1xuICAgIHRoaXMubWFza3MgPSB7fTtcbiAgICB0aGlzLmh0bWwgPSBcIjxzdmcgaWQ9J1wiICsgb3B0aW9ucy5pZCArIFwiJyB3aWR0aD0nXCIgKyB0aGlzLndpZHRoICsgXCInIGhlaWdodD0nXCIgKyB0aGlzLmhlaWdodCArIFwiJz48ZGVmcz48L2RlZnM+PC9zdmc+XCI7XG4gICAgdGhpcy5zdmcgPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoXCIjXCIgKyBvcHRpb25zLmlkKTtcbiAgfVxuXG4gIExheWVyU1ZHLnByb3RvdHlwZS5hZGRTaGFwZSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICB2YXIgb3B0aW9uLCBzaGFwZSwgdmFsdWU7XG4gICAgaWYgKG9wdGlvbnMgPT0gbnVsbCkge1xuICAgICAgb3B0aW9ucyA9IHt9O1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5zaGFwZSA9PT0gXCJyZWN0YW5nbGVcIikge1xuICAgICAgb3B0aW9ucy5zaGFwZSA9IFwicmVjdFwiO1xuICAgIH1cbiAgICBzaGFwZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwiXCIgKyBvcHRpb25zLnNoYXBlKTtcbiAgICBmb3IgKG9wdGlvbiBpbiBvcHRpb25zKSB7XG4gICAgICBpZiAoIWhhc1Byb3AuY2FsbChvcHRpb25zLCBvcHRpb24pKSBjb250aW51ZTtcbiAgICAgIHZhbHVlID0gb3B0aW9uc1tvcHRpb25dO1xuICAgICAgaWYgKG9wdGlvbiAhPT0gXCJzaGFwZVwiKSB7XG4gICAgICAgIHNoYXBlLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiXCIgKyBvcHRpb24sIFwiXCIgKyBvcHRpb25zW29wdGlvbl0pO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnN2Zy5hcHBlbmRDaGlsZChzaGFwZSk7XG4gICAgdGhpcy5zaGFwZXNbXCJcIiArIG9wdGlvbnMuaWRdID0gc2hhcGU7XG4gICAgcmV0dXJuIHNoYXBlO1xuICB9O1xuXG4gIExheWVyU1ZHLnByb3RvdHlwZS5hZGRNYXNrID0gZnVuY3Rpb24oaWQsIHNoYXBlKSB7XG4gICAgdmFyIGRlZnMsIGVsZW1lbnQsIGksIGxlbiwgbWFzaztcbiAgICBtYXNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJtYXNrXCIpO1xuICAgIG1hc2suc2V0QXR0cmlidXRlTlMobnVsbCwgXCJpZFwiLCBcIlwiICsgaWQpO1xuICAgIGlmICghQXJyYXkuaXNBcnJheShzaGFwZSkpIHtcbiAgICAgIGlmICh0eXBlb2Ygc2hhcGUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgc2hhcGUgPSB0aGlzLnN2Zy5nZXRFbGVtZW50QnlJZChcIlwiICsgc2hhcGUpO1xuICAgICAgICBtYXNrLmFwcGVuZENoaWxkKHNoYXBlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1hc2suYXBwZW5kQ2hpbGQoc2hhcGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGkgPSAwLCBsZW4gPSBzaGFwZS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBlbGVtZW50ID0gc2hhcGVbaV07XG4gICAgICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIGVsZW1lbnQgPSB0aGlzLnN2Zy5nZXRFbGVtZW50QnlJZChcIlwiICsgZWxlbWVudCk7XG4gICAgICAgICAgbWFzay5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtYXNrLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGRlZnMgPSB0aGlzLnN2Zy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImRlZnNcIilbMF07XG4gICAgZGVmcy5hcHBlbmRDaGlsZChtYXNrKTtcbiAgICByZXR1cm4gdGhpcy5tYXNrc1tcIlwiICsgaWRdID0gbWFzaztcbiAgfTtcblxuICBMYXllclNWRy5wcm90b3R5cGUuYWRkVG9NYXNrID0gZnVuY3Rpb24oc2hhcGUsIG1hc2ssIHByZXZFbGVtZW50KSB7XG4gICAgaWYgKHR5cGVvZiBtYXNrID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBtYXNrID0gdGhpcy5zdmcuZ2V0RWxlbWVudEJ5SWQoXCJcIiArIG1hc2spO1xuICAgIH1cbiAgICBpZiAoIXByZXZFbGVtZW50KSB7XG4gICAgICByZXR1cm4gbWFzay5hcHBlbmRDaGlsZChzaGFwZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBtYXNrLmluc2VydEJlZm9yZShzaGFwZSwgcHJldkVsZW1lbnQpO1xuICAgIH1cbiAgfTtcblxuICBMYXllclNWRy5wcm90b3R5cGUubWFzayA9IGZ1bmN0aW9uKGVsZW1lbnQsIGlkKSB7XG4gICAgaWYgKHR5cGVvZiBpZCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgaWQgPSBpZC5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcImlkXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcIm1hc2tcIiwgXCJ1cmwoI1wiICsgaWQgKyBcIilcIik7XG4gIH07XG5cbiAgcmV0dXJuIExheWVyU1ZHO1xuXG59KShMYXllcik7XG4iLCJjbGFzcyBleHBvcnRzLkxheWVyU1ZHIGV4dGVuZHMgTGF5ZXIgXG5cdGNvbnN0cnVjdG9yOiAob3B0aW9ucz17fSkgLT5cblx0XHRcblx0XHRzdXBlciBvcHRpb25zXG5cblx0XHRAc2hhcGVzID0ge31cblx0XHRAbWFza3MgPSB7fVxuXHRcdEBodG1sID0gXCI8c3ZnIGlkPScje29wdGlvbnMuaWR9JyB3aWR0aD0nI3tALndpZHRofScgaGVpZ2h0PScje0AuaGVpZ2h0fSc+PGRlZnM+PC9kZWZzPjwvc3ZnPlwiXG5cdFx0QHN2ZyA9IEAucXVlcnlTZWxlY3RvcihcIiMje29wdGlvbnMuaWR9XCIpXHRcblxuXG5cdGFkZFNoYXBlOiAob3B0aW9ucz17fSkgLT5cblxuXHRcdGlmIG9wdGlvbnMuc2hhcGUgaXMgXCJyZWN0YW5nbGVcIlxuXHRcdFx0b3B0aW9ucy5zaGFwZSA9IFwicmVjdFwiXG5cblx0XHRzaGFwZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwiI3tvcHRpb25zLnNoYXBlfVwiKSBcblxuXHRcdGZvciBvd24gb3B0aW9uLCB2YWx1ZSBvZiBvcHRpb25zXG5cdFx0XHRpZiBvcHRpb24gaXNudCBcInNoYXBlXCJcblx0XHRcdFx0c2hhcGUuc2V0QXR0cmlidXRlTlMobnVsbCwgXCIje29wdGlvbn1cIiwgXCIje29wdGlvbnNbb3B0aW9uXX1cIilcblxuXHRcdEBzdmcuYXBwZW5kQ2hpbGQoc2hhcGUpXG5cdFx0QHNoYXBlc1tcIiN7b3B0aW9ucy5pZH1cIl0gPSBzaGFwZVxuXG5cdFx0cmV0dXJuIHNoYXBlXG5cblx0YWRkTWFzazogKGlkLCBzaGFwZSkgLT5cblx0XHRtYXNrID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJtYXNrXCIpXG5cdFx0bWFzay5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcImlkXCIsIFwiI3tpZH1cIilcblxuXHRcdGlmICFBcnJheS5pc0FycmF5KHNoYXBlKVxuXHRcdFx0aWYgdHlwZW9mKHNoYXBlKSBpcyBcInN0cmluZ1wiXG5cdFx0XHRcdHNoYXBlID0gQC5zdmcuZ2V0RWxlbWVudEJ5SWQoXCIje3NoYXBlfVwiKVxuXHRcdFx0XHRtYXNrLmFwcGVuZENoaWxkKHNoYXBlKVxuXHRcdFx0ZWxzZVxuXHRcdFx0XHRtYXNrLmFwcGVuZENoaWxkKHNoYXBlKVxuXHRcdGVsc2Vcblx0XHRcdGZvciBlbGVtZW50IGluIHNoYXBlIFxuXHRcdFx0XHRpZiB0eXBlb2YoZWxlbWVudCkgaXMgXCJzdHJpbmdcIlxuXHRcdFx0XHRcdGVsZW1lbnQgPSBALnN2Zy5nZXRFbGVtZW50QnlJZChcIiN7ZWxlbWVudH1cIilcblx0XHRcdFx0XHRtYXNrLmFwcGVuZENoaWxkKGVsZW1lbnQpXG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHRtYXNrLmFwcGVuZENoaWxkKGVsZW1lbnQpXG5cblx0XHRkZWZzID0gQC5zdmcuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJkZWZzXCIpWzBdXG5cdFx0ZGVmcy5hcHBlbmRDaGlsZChtYXNrKVxuXHRcdEBtYXNrc1tcIiN7aWR9XCJdID0gbWFza1xuXG5cdGFkZFRvTWFzazogKHNoYXBlLCBtYXNrLCBwcmV2RWxlbWVudCkgLT5cblx0XHRpZiB0eXBlb2YobWFzaykgaXMgXCJzdHJpbmdcIlxuXHRcdFx0bWFzayA9IEAuc3ZnLmdldEVsZW1lbnRCeUlkKFwiI3ttYXNrfVwiKVxuXG5cdFx0aWYgIXByZXZFbGVtZW50XG5cdFx0XHRtYXNrLmFwcGVuZENoaWxkKHNoYXBlKVxuXHRcdGVsc2Vcblx0XHRcdG1hc2suaW5zZXJ0QmVmb3JlKHNoYXBlLCBwcmV2RWxlbWVudClcblxuXHRtYXNrOiAoZWxlbWVudCwgaWQpIC0+XG5cdFx0aWYgdHlwZW9mKGlkKSBpc250IFwic3RyaW5nXCJcblx0XHRcdGlkID0gaWQuZ2V0QXR0cmlidXRlTlMobnVsbCwgXCJpZFwiKVxuXG5cdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcIm1hc2tcIiwgXCJ1cmwoIyN7aWR9KVwiKVxuXHRcdCIsIiMgQWRkIHRoZSBmb2xsb3dpbmcgbGluZSB0byB5b3VyIHByb2plY3QgaW4gRnJhbWVyIFN0dWRpby4gXG4jIG15TW9kdWxlID0gcmVxdWlyZSBcIm15TW9kdWxlXCJcbiMgUmVmZXJlbmNlIHRoZSBjb250ZW50cyBieSBuYW1lLCBsaWtlIG15TW9kdWxlLm15RnVuY3Rpb24oKSBvciBteU1vZHVsZS5teVZhclxuXG5leHBvcnRzLm15VmFyID0gXCJteVZhcmlhYmxlXCJcblxuZXhwb3J0cy5teUZ1bmN0aW9uID0gLT5cblx0cHJpbnQgXCJteUZ1bmN0aW9uIGlzIHJ1bm5pbmdcIlxuXG5leHBvcnRzLm15QXJyYXkgPSBbMSwgMiwgM10iXX0=
