require=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"LayerSVG":[function(require,module,exports){
// Generated by CoffeeScript 1.9.1
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

exports.LayerSVG = (function(superClass) {
  var _insertBefore;

  extend(LayerSVG, superClass);

  function LayerSVG(options) {
    if (options == null) {
      options = {};
    }
    LayerSVG.__super__.constructor.call(this, options);
    this.shapes = {};
    this.masks = {};
    this.html = "<svg id='" + options.id + "' width='" + this.width + "' height='" + this.height + "'><defs></defs></svg>";
    this.svg = this.querySelector("#" + options.id);
  }

  LayerSVG.prototype.addShape = function(options) {
    var option, shape, value;
    if (options == null) {
      options = {};
    }
    if (options.shape === "rectangle") {
      options.shape = "rect";
    }
    shape = document.createElementNS("http://www.w3.org/2000/svg", "" + options.shape);
    for (option in options) {
      if (!hasProp.call(options, option)) continue;
      value = options[option];
      if (option !== "shape") {
        shape.setAttributeNS(null, "" + option, "" + options[option]);
      }
    }
    this.svg.appendChild(shape);
    this.shapes["" + options.id] = shape;
    return shape;
  };

  LayerSVG.prototype.addMask = function(id, shapes) {
    var defs, i, len, mask, shape;
    mask = document.createElementNS("http://www.w3.org/2000/svg", "mask");
    mask.setAttributeNS(null, "id", "" + id);
    if (!Array.isArray(shapes)) {
      shape = shapes;
      if (typeof shape === "string") {
        shape = this.svg.getElementById("" + shape);
        mask.appendChild(shape);
      } else {
        mask.appendChild(shape);
      }
    } else {
      for (i = 0, len = shapes.length; i < len; i++) {
        shape = shapes[i];
        if (typeof shape === "string") {
          shape = this.svg.getElementById("" + shape);
          mask.appendChild(shape);
        } else {
          mask.appendChild(shape);
        }
      }
    }
    defs = this.svg.getElementsByTagName("defs")[0];
    defs.appendChild(mask);
    return this.masks["" + id] = mask;
  };

  LayerSVG.prototype.addToMask = function(shapes, mask, prevShape) {
    var i, len, results, shape;
    if (!Array.isArray(shapes)) {
      shape = shapes;
      if (typeof shape === "string") {
        shape = this.svg.getElementById("" + shape);
      }
      return _insertBefore(shape, mask, prevShape);
    } else {
      results = [];
      for (i = 0, len = shapes.length; i < len; i++) {
        shape = shapes[i];
        print(shape);
        if (typeof shape === "string") {
          shape = this.svg.getElementById("" + element);
        }
        results.push(_insertBefore(shape, mask, prevShape));
      }
      return results;
    }
  };

  LayerSVG.prototype.mask = function(element, id) {
    if (typeof id !== "string") {
      id = id.getAttributeNS(null, "id");
    }
    return element.setAttributeNS(null, "mask", "url(#" + id + ")");
  };

  _insertBefore = function(shape, mask, prevShape) {
    if (!prevShape) {
      return mask.appendChild(shape);
    } else {
      if (typeof prevShape === "string") {
        prevShape = this.svg.getElementById("" + prevShape);
      }
      return mask.insertBefore(shape, prevShape);
    }
  };

  return LayerSVG;

})(Layer);

},{}],"LayerSVG":[function(require,module,exports){
var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  hasProp = {}.hasOwnProperty;

exports.LayerSVG = (function(superClass) {
  var _insertBefore;

  extend(LayerSVG, superClass);

  function LayerSVG(options) {
    if (options == null) {
      options = {};
    }
    LayerSVG.__super__.constructor.call(this, options);
    this.shapes = {};
    this.masks = {};
    this.html = "<svg id='" + options.id + "' width='" + this.width + "' height='" + this.height + "'><defs></defs></svg>";
    this.svg = this.querySelector("#" + options.id);
  }

  LayerSVG.prototype.addShape = function(options) {
    var option, shape, value;
    if (options == null) {
      options = {};
    }
    if (options.shape === "rectangle") {
      options.shape = "rect";
    }
    shape = document.createElementNS("http://www.w3.org/2000/svg", "" + options.shape);
    for (option in options) {
      if (!hasProp.call(options, option)) continue;
      value = options[option];
      if (option !== "shape") {
        shape.setAttributeNS(null, "" + option, "" + options[option]);
      }
    }
    this.svg.appendChild(shape);
    this.shapes["" + options.id] = shape;
    return shape;
  };

  LayerSVG.prototype.addMask = function(id, shapes) {
    var defs, i, len, mask, shape;
    mask = document.createElementNS("http://www.w3.org/2000/svg", "mask");
    mask.setAttributeNS(null, "id", "" + id);
    if (!Array.isArray(shapes)) {
      shape = shapes;
      if (typeof shape === "string") {
        shape = this.svg.getElementById("" + shape);
        mask.appendChild(shape);
      } else {
        mask.appendChild(shape);
      }
    } else {
      for (i = 0, len = shapes.length; i < len; i++) {
        shape = shapes[i];
        if (typeof shape === "string") {
          shape = this.svg.getElementById("" + shape);
          mask.appendChild(shape);
        } else {
          mask.appendChild(shape);
        }
      }
    }
    defs = this.svg.getElementsByTagName("defs")[0];
    defs.appendChild(mask);
    return this.masks["" + id] = mask;
  };

  LayerSVG.prototype.addToMask = function(shapes, mask, prevShape) {
    var i, len, results, shape;
    if (!Array.isArray(shapes)) {
      shape = shapes;
      if (typeof shape === "string") {
        shape = this.svg.getElementById("" + shape);
      }
      return _insertBefore(shape, mask, prevShape);
    } else {
      results = [];
      for (i = 0, len = shapes.length; i < len; i++) {
        shape = shapes[i];
        print(shape);
        if (typeof shape === "string") {
          shape = this.svg.getElementById("" + element);
        }
        results.push(_insertBefore(shape, mask, prevShape));
      }
      return results;
    }
  };

  LayerSVG.prototype.mask = function(element, id) {
    if (typeof id !== "string") {
      id = id.getAttributeNS(null, "id");
    }
    return element.setAttributeNS(null, "mask", "url(#" + id + ")");
  };

  _insertBefore = function(shape, mask, prevShape) {
    if (!prevShape) {
      return mask.appendChild(shape);
    } else {
      if (typeof prevShape === "string") {
        prevShape = this.svg.getElementById("" + prevShape);
      }
      return mask.insertBefore(shape, prevShape);
    }
  };

  return LayerSVG;

})(Layer);



},{}],"myModule":[function(require,module,exports){
exports.myVar = "myVariable";

exports.myFunction = function() {
  return print("myFunction is running");
};

exports.myArray = [1, 2, 3];



},{}]},{},[])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIuLi8uLi8uLi8uLi8uLi9Vc2Vycy9qb3NobXR1Y2tlci9HaXRIdWIvTGF5ZXJTVkcvTGF5ZXJTVkcuZnJhbWVyL21vZHVsZXMvTGF5ZXJTVkcuanMiLCIvVXNlcnMvam9zaG10dWNrZXIvR2l0SHViL0xheWVyU1ZHL0xheWVyU1ZHLmZyYW1lci9tb2R1bGVzL0xheWVyU1ZHLmNvZmZlZSIsIi9Vc2Vycy9qb3NobXR1Y2tlci9HaXRIdWIvTGF5ZXJTVkcvTGF5ZXJTVkcuZnJhbWVyL21vZHVsZXMvbXlNb2R1bGUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QkFpRUEsSUFBQSxHQUFNLFNBQUMsT0FBRCxFQUFVLEVBQVYsR0FBQTtBQUNMLElBQUEsSUFBRyxNQUFBLENBQUEsRUFBQSxLQUFnQixRQUFuQjtBQUNDLE1BQUEsRUFBQSxHQUFLLEVBQUUsQ0FBQyxjQUFILENBQWtCLElBQWxCLEVBQXdCLElBQXhCLENBQUwsQ0FERDtLQUFBO1dBR0EsT0FBTyxDQUFDLGNBQVIsQ0FBdUIsSUFBdkIsRUFBNkIsTUFBN0IsRUFBcUMsT0FBQSxHQUFRLEVBQVIsR0FBVyxHQUFoRCxFQUpLO0VBQUEsQ0FqRU4sQ0FBQTs7QUFBQSxFQXVFQSxhQUFBLEdBQWdCLFNBQUMsS0FBRCxFQUFRLElBQVIsRUFBYyxTQUFkLEdBQUE7QUFDZixJQUFBLElBQUcsQ0FBQSxTQUFIO2FBQ0MsSUFBSSxDQUFDLFdBQUwsQ0FBaUIsS0FBakIsRUFERDtLQUFBLE1BQUE7QUFHQyxNQUFBLElBQUcsTUFBQSxDQUFBLFNBQUEsS0FBcUIsUUFBeEI7QUFDQyxRQUFBLFNBQUEsR0FBWSxJQUFDLENBQUMsR0FBRyxDQUFDLGNBQU4sQ0FBcUIsRUFBQSxHQUFHLFNBQXhCLENBQVosQ0FERDtPQUFBO2FBR0EsSUFBSSxDQUFDLFlBQUwsQ0FBa0IsS0FBbEIsRUFBeUIsU0FBekIsRUFORDtLQURlO0VBQUEsQ0F2RWhCLENBQUE7O2tCQUFBOztHQUQ4QixNQUEvQixDQUFBOzs7OztBQ0lBLE9BQU8sQ0FBQyxLQUFSLEdBQWdCLFlBQWhCLENBQUE7O0FBQUEsT0FFTyxDQUFDLFVBQVIsR0FBcUIsU0FBQSxHQUFBO1NBQ3BCLEtBQUEsQ0FBTSx1QkFBTixFQURvQjtBQUFBLENBRnJCLENBQUE7O0FBQUEsT0FLTyxDQUFDLE9BQVIsR0FBa0IsQ0FBQyxDQUFELEVBQUksQ0FBSixFQUFPLENBQVAsQ0FMbEIsQ0FBQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuOS4xXG52YXIgZXh0ZW5kID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChoYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9LFxuICBoYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHk7XG5cbmV4cG9ydHMuTGF5ZXJTVkcgPSAoZnVuY3Rpb24oc3VwZXJDbGFzcykge1xuICB2YXIgX2luc2VydEJlZm9yZTtcblxuICBleHRlbmQoTGF5ZXJTVkcsIHN1cGVyQ2xhc3MpO1xuXG4gIGZ1bmN0aW9uIExheWVyU1ZHKG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuICAgIExheWVyU1ZHLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMsIG9wdGlvbnMpO1xuICAgIHRoaXMuc2hhcGVzID0ge307XG4gICAgdGhpcy5tYXNrcyA9IHt9O1xuICAgIHRoaXMuaHRtbCA9IFwiPHN2ZyBpZD0nXCIgKyBvcHRpb25zLmlkICsgXCInIHdpZHRoPSdcIiArIHRoaXMud2lkdGggKyBcIicgaGVpZ2h0PSdcIiArIHRoaXMuaGVpZ2h0ICsgXCInPjxkZWZzPjwvZGVmcz48L3N2Zz5cIjtcbiAgICB0aGlzLnN2ZyA9IHRoaXMucXVlcnlTZWxlY3RvcihcIiNcIiArIG9wdGlvbnMuaWQpO1xuICB9XG5cbiAgTGF5ZXJTVkcucHJvdG90eXBlLmFkZFNoYXBlID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHZhciBvcHRpb24sIHNoYXBlLCB2YWx1ZTtcbiAgICBpZiAob3B0aW9ucyA9PSBudWxsKSB7XG4gICAgICBvcHRpb25zID0ge307XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnNoYXBlID09PSBcInJlY3RhbmdsZVwiKSB7XG4gICAgICBvcHRpb25zLnNoYXBlID0gXCJyZWN0XCI7XG4gICAgfVxuICAgIHNoYXBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJcIiArIG9wdGlvbnMuc2hhcGUpO1xuICAgIGZvciAob3B0aW9uIGluIG9wdGlvbnMpIHtcbiAgICAgIGlmICghaGFzUHJvcC5jYWxsKG9wdGlvbnMsIG9wdGlvbikpIGNvbnRpbnVlO1xuICAgICAgdmFsdWUgPSBvcHRpb25zW29wdGlvbl07XG4gICAgICBpZiAob3B0aW9uICE9PSBcInNoYXBlXCIpIHtcbiAgICAgICAgc2hhcGUuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJcIiArIG9wdGlvbiwgXCJcIiArIG9wdGlvbnNbb3B0aW9uXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuc3ZnLmFwcGVuZENoaWxkKHNoYXBlKTtcbiAgICB0aGlzLnNoYXBlc1tcIlwiICsgb3B0aW9ucy5pZF0gPSBzaGFwZTtcbiAgICByZXR1cm4gc2hhcGU7XG4gIH07XG5cbiAgTGF5ZXJTVkcucHJvdG90eXBlLmFkZE1hc2sgPSBmdW5jdGlvbihpZCwgc2hhcGVzKSB7XG4gICAgdmFyIGRlZnMsIGksIGxlbiwgbWFzaywgc2hhcGU7XG4gICAgbWFzayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwibWFza1wiKTtcbiAgICBtYXNrLnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiaWRcIiwgXCJcIiArIGlkKTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2hhcGVzKSkge1xuICAgICAgc2hhcGUgPSBzaGFwZXM7XG4gICAgICBpZiAodHlwZW9mIHNoYXBlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHNoYXBlID0gdGhpcy5zdmcuZ2V0RWxlbWVudEJ5SWQoXCJcIiArIHNoYXBlKTtcbiAgICAgICAgbWFzay5hcHBlbmRDaGlsZChzaGFwZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtYXNrLmFwcGVuZENoaWxkKHNoYXBlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChpID0gMCwgbGVuID0gc2hhcGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHNoYXBlID0gc2hhcGVzW2ldO1xuICAgICAgICBpZiAodHlwZW9mIHNoYXBlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgc2hhcGUgPSB0aGlzLnN2Zy5nZXRFbGVtZW50QnlJZChcIlwiICsgc2hhcGUpO1xuICAgICAgICAgIG1hc2suYXBwZW5kQ2hpbGQoc2hhcGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1hc2suYXBwZW5kQ2hpbGQoc2hhcGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGRlZnMgPSB0aGlzLnN2Zy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImRlZnNcIilbMF07XG4gICAgZGVmcy5hcHBlbmRDaGlsZChtYXNrKTtcbiAgICByZXR1cm4gdGhpcy5tYXNrc1tcIlwiICsgaWRdID0gbWFzaztcbiAgfTtcblxuICBMYXllclNWRy5wcm90b3R5cGUuYWRkVG9NYXNrID0gZnVuY3Rpb24oc2hhcGVzLCBtYXNrLCBwcmV2U2hhcGUpIHtcbiAgICB2YXIgaSwgbGVuLCByZXN1bHRzLCBzaGFwZTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2hhcGVzKSkge1xuICAgICAgc2hhcGUgPSBzaGFwZXM7XG4gICAgICBpZiAodHlwZW9mIHNoYXBlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHNoYXBlID0gdGhpcy5zdmcuZ2V0RWxlbWVudEJ5SWQoXCJcIiArIHNoYXBlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfaW5zZXJ0QmVmb3JlKHNoYXBlLCBtYXNrLCBwcmV2U2hhcGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXN1bHRzID0gW107XG4gICAgICBmb3IgKGkgPSAwLCBsZW4gPSBzaGFwZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgc2hhcGUgPSBzaGFwZXNbaV07XG4gICAgICAgIHByaW50KHNoYXBlKTtcbiAgICAgICAgaWYgKHR5cGVvZiBzaGFwZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIHNoYXBlID0gdGhpcy5zdmcuZ2V0RWxlbWVudEJ5SWQoXCJcIiArIGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdHMucHVzaChfaW5zZXJ0QmVmb3JlKHNoYXBlLCBtYXNrLCBwcmV2U2hhcGUpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH1cbiAgfTtcblxuICBMYXllclNWRy5wcm90b3R5cGUubWFzayA9IGZ1bmN0aW9uKGVsZW1lbnQsIGlkKSB7XG4gICAgaWYgKHR5cGVvZiBpZCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgaWQgPSBpZC5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcImlkXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcIm1hc2tcIiwgXCJ1cmwoI1wiICsgaWQgKyBcIilcIik7XG4gIH07XG5cbiAgX2luc2VydEJlZm9yZSA9IGZ1bmN0aW9uKHNoYXBlLCBtYXNrLCBwcmV2U2hhcGUpIHtcbiAgICBpZiAoIXByZXZTaGFwZSkge1xuICAgICAgcmV0dXJuIG1hc2suYXBwZW5kQ2hpbGQoc2hhcGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodHlwZW9mIHByZXZTaGFwZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBwcmV2U2hhcGUgPSB0aGlzLnN2Zy5nZXRFbGVtZW50QnlJZChcIlwiICsgcHJldlNoYXBlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtYXNrLmluc2VydEJlZm9yZShzaGFwZSwgcHJldlNoYXBlKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIExheWVyU1ZHO1xuXG59KShMYXllcik7XG4iLCJjbGFzcyBleHBvcnRzLkxheWVyU1ZHIGV4dGVuZHMgTGF5ZXIgXG5cdGNvbnN0cnVjdG9yOiAob3B0aW9ucz17fSkgLT5cblx0XHRcblx0XHRzdXBlciBvcHRpb25zXG5cblx0XHRAc2hhcGVzID0ge31cblx0XHRAbWFza3MgPSB7fVxuXHRcdEBodG1sID0gXCI8c3ZnIGlkPScje29wdGlvbnMuaWR9JyB3aWR0aD0nI3tALndpZHRofScgaGVpZ2h0PScje0AuaGVpZ2h0fSc+PGRlZnM+PC9kZWZzPjwvc3ZnPlwiXG5cdFx0QHN2ZyA9IEAucXVlcnlTZWxlY3RvcihcIiMje29wdGlvbnMuaWR9XCIpXHRcblxuXG5cdGFkZFNoYXBlOiAob3B0aW9ucz17fSkgLT5cblxuXHRcdGlmIG9wdGlvbnMuc2hhcGUgaXMgXCJyZWN0YW5nbGVcIlxuXHRcdFx0b3B0aW9ucy5zaGFwZSA9IFwicmVjdFwiXG5cblx0XHRzaGFwZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwiI3tvcHRpb25zLnNoYXBlfVwiKSBcblxuXHRcdGZvciBvd24gb3B0aW9uLCB2YWx1ZSBvZiBvcHRpb25zXG5cdFx0XHRpZiBvcHRpb24gaXNudCBcInNoYXBlXCJcblx0XHRcdFx0c2hhcGUuc2V0QXR0cmlidXRlTlMobnVsbCwgXCIje29wdGlvbn1cIiwgXCIje29wdGlvbnNbb3B0aW9uXX1cIilcblxuXHRcdEBzdmcuYXBwZW5kQ2hpbGQoc2hhcGUpXG5cdFx0QHNoYXBlc1tcIiN7b3B0aW9ucy5pZH1cIl0gPSBzaGFwZVxuXG5cdFx0cmV0dXJuIHNoYXBlXG5cblx0YWRkTWFzazogKGlkLCBzaGFwZXMpIC0+XG5cdFx0bWFzayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwibWFza1wiKVxuXHRcdG1hc2suc2V0QXR0cmlidXRlTlMobnVsbCwgXCJpZFwiLCBcIiN7aWR9XCIpXG5cblx0XHRpZiAhQXJyYXkuaXNBcnJheShzaGFwZXMpXG5cdFx0XHRzaGFwZSA9IHNoYXBlc1xuXHRcdFx0aWYgdHlwZW9mKHNoYXBlKSBpcyBcInN0cmluZ1wiXG5cdFx0XHRcdHNoYXBlID0gQC5zdmcuZ2V0RWxlbWVudEJ5SWQoXCIje3NoYXBlfVwiKVxuXHRcdFx0XHRtYXNrLmFwcGVuZENoaWxkKHNoYXBlKVxuXHRcdFx0ZWxzZVxuXHRcdFx0XHRtYXNrLmFwcGVuZENoaWxkKHNoYXBlKVxuXHRcdGVsc2Vcblx0XHRcdGZvciBzaGFwZSBpbiBzaGFwZXMgXG5cdFx0XHRcdGlmIHR5cGVvZihzaGFwZSkgaXMgXCJzdHJpbmdcIlxuXHRcdFx0XHRcdHNoYXBlID0gQC5zdmcuZ2V0RWxlbWVudEJ5SWQoXCIje3NoYXBlfVwiKVxuXHRcdFx0XHRcdG1hc2suYXBwZW5kQ2hpbGQoc2hhcGUpXG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHRtYXNrLmFwcGVuZENoaWxkKHNoYXBlKVxuXG5cdFx0ZGVmcyA9IEAuc3ZnLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiZGVmc1wiKVswXVxuXHRcdGRlZnMuYXBwZW5kQ2hpbGQobWFzaylcblx0XHRAbWFza3NbXCIje2lkfVwiXSA9IG1hc2tcblxuXHRhZGRUb01hc2s6IChzaGFwZXMsIG1hc2ssIHByZXZTaGFwZSkgLT5cblx0XHRpZiAhQXJyYXkuaXNBcnJheShzaGFwZXMpXG5cdFx0XHRzaGFwZSA9IHNoYXBlc1xuXHRcdFx0XG5cdFx0XHRpZiB0eXBlb2Yoc2hhcGUpIGlzIFwic3RyaW5nXCJcblx0XHRcdFx0c2hhcGUgPSBALnN2Zy5nZXRFbGVtZW50QnlJZChcIiN7c2hhcGV9XCIpXG5cblx0XHRcdF9pbnNlcnRCZWZvcmUoc2hhcGUsIG1hc2ssIHByZXZTaGFwZSlcblx0XHRlbHNlXG5cdFx0XHRmb3Igc2hhcGUgaW4gc2hhcGVzXG5cdFx0XHRcdHByaW50IHNoYXBlXG5cdFx0XHRcdGlmIHR5cGVvZihzaGFwZSkgaXMgXCJzdHJpbmdcIlxuXHRcdFx0XHRcdHNoYXBlID0gQC5zdmcuZ2V0RWxlbWVudEJ5SWQoXCIje2VsZW1lbnR9XCIpXG5cblx0XHRcdFx0X2luc2VydEJlZm9yZShzaGFwZSwgbWFzaywgcHJldlNoYXBlKVxuXG5cdG1hc2s6IChlbGVtZW50LCBpZCkgLT5cblx0XHRpZiB0eXBlb2YoaWQpIGlzbnQgXCJzdHJpbmdcIlxuXHRcdFx0aWQgPSBpZC5nZXRBdHRyaWJ1dGVOUyhudWxsLCBcImlkXCIpXG5cblx0XHRlbGVtZW50LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwibWFza1wiLCBcInVybCgjI3tpZH0pXCIpXG5cblx0X2luc2VydEJlZm9yZSA9IChzaGFwZSwgbWFzaywgcHJldlNoYXBlKSAtPlxuXHRcdGlmICFwcmV2U2hhcGVcblx0XHRcdG1hc2suYXBwZW5kQ2hpbGQoc2hhcGUpXG5cdFx0ZWxzZSBcblx0XHRcdGlmIHR5cGVvZihwcmV2U2hhcGUpIGlzIFwic3RyaW5nXCJcblx0XHRcdFx0cHJldlNoYXBlID0gQC5zdmcuZ2V0RWxlbWVudEJ5SWQoXCIje3ByZXZTaGFwZX1cIilcblxuXHRcdFx0bWFzay5pbnNlcnRCZWZvcmUoc2hhcGUsIHByZXZTaGFwZSlcblx0XHQiLCIjIEFkZCB0aGUgZm9sbG93aW5nIGxpbmUgdG8geW91ciBwcm9qZWN0IGluIEZyYW1lciBTdHVkaW8uIFxuIyBteU1vZHVsZSA9IHJlcXVpcmUgXCJteU1vZHVsZVwiXG4jIFJlZmVyZW5jZSB0aGUgY29udGVudHMgYnkgbmFtZSwgbGlrZSBteU1vZHVsZS5teUZ1bmN0aW9uKCkgb3IgbXlNb2R1bGUubXlWYXJcblxuZXhwb3J0cy5teVZhciA9IFwibXlWYXJpYWJsZVwiXG5cbmV4cG9ydHMubXlGdW5jdGlvbiA9IC0+XG5cdHByaW50IFwibXlGdW5jdGlvbiBpcyBydW5uaW5nXCJcblxuZXhwb3J0cy5teUFycmF5ID0gWzEsIDIsIDNdIl19
